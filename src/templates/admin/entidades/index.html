{% extends "admin/base.html" %}
{% block title %}Gestión de Entidades Administrativas{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="h3 mb-3">
                <i class="fas fa-cogs me-2"></i>Gestión de Entidades Administrativas
            </h1>
            
            <p class="text-muted mb-4">
                Administra todas las entidades del sistema: municipios, profesiones, bancos, EPS, AFP, ARL, 
                cajas de compensación, operadores de seguridad social y áreas de personal.
            </p>
        </div>
    </div>

    <!-- Panel de estadísticas -->
    <div class="row mb-4">
        {% for tipo, stat in stats.items() %}
        <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
            <div class="card h-100 border-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="card-title text-primary mb-0">
                            {{ stat.config.nombre }}
                        </h5>
                        <i class="fas fa-list-alt text-primary"></i>
                    </div>
                    
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="h4 mb-0 text-success">{{ stat.activos }}</div>
                            <small class="text-muted">Activos</small>
                        </div>
                        <div class="col-4">
                            <div class="h4 mb-0 text-warning">{{ stat.inactivos }}</div>
                            <small class="text-muted">Inactivos</small>
                        </div>
                        <div class="col-4">
                            <div class="h4 mb-0 text-info">{{ stat.total }}</div>
                            <small class="text-muted">Total</small>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <a href="{{ url_for('entidades.listar_entidades', tipo=tipo) }}" 
                           class="btn btn-primary btn-sm me-2">
                            <i class="fas fa-list me-1"></i>Ver Lista
                        </a>
                        <a href="{{ url_for('entidades.crear_entidad', tipo=tipo) }}" 
                           class="btn btn-success btn-sm">
                            <i class="fas fa-plus me-1"></i>Nuevo
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Panel de acciones rápidas -->
    <div class="row">
        <div class="col-12">
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-rocket me-2"></i>Acciones Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6 class="text-primary">Gestión Masiva</h6>
                            <p class="small text-muted">Herramientas para gestionar múltiples entidades.</p>
                            <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalImportar">
                                <i class="fas fa-file-import me-1"></i>Importar CSV
                            </button>
                            <button class="btn btn-outline-success btn-sm ms-2" onclick="exportarEntidades()">
                                <i class="fas fa-file-export me-1"></i>Exportar
                            </button>
                        </div>
                        
                        <div class="col-md-4">
                            <h6 class="text-success">Estados</h6>
                            <p class="small text-muted">Gestionar el estado de las entidades.</p>
                            <button class="btn btn-outline-warning btn-sm" onclick="activarTodas()">
                                <i class="fas fa-toggle-on me-1"></i>Activar Todas
                            </button>
                            <button class="btn btn-outline-danger btn-sm ms-2" onclick="desactivarInactivas()">
                                <i class="fas fa-trash me-1"></i>Limpiar Inactivas
                            </button>
                        </div>
                        
                        <div class="col-md-4">
                            <h6 class="text-info">Estadísticas</h6>
                            <p class="small text-muted">Información y reportes del sistema.</p>
                            <button class="btn btn-outline-info btn-sm" onclick="generarReporte()">
                                <i class="fas fa-chart-bar me-1"></i>Generar Reporte
                            </button>
                            <a href="/admin/entidades/api/all" class="btn btn-outline-secondary btn-sm ms-2" target="_blank">
                                <i class="fas fa-code me-1"></i>Ver API
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para importar -->
<div class="modal fade" id="modalImportar" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Importar Entidades</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formImportar" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="tipoImportar" class="form-label">Tipo de Entidad</label>
                        <select class="form-select" id="tipoImportar" name="tipo" required>
                            {% for tipo, config in tipos.items() %}
                            <option value="{{ tipo }}">{{ config.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="archivoCSV" class="form-label">Archivo CSV</label>
                        <input type="file" class="form-control" id="archivoCSV" name="archivo" accept=".csv" required>
                        <div class="form-text">
                            El archivo debe tener las columnas: codigo, nombre, descripcion (opcional)
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="importarEntidades()">
                    <i class="fas fa-upload me-1"></i>Importar
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Funciones de acciones rápidas
function exportarEntidades() {
    const url = '/admin/entidades/api/all';
    window.open(url, '_blank');
}

function activarTodas() {
    if (confirm('¿Está seguro de que desea activar todas las entidades inactivas?')) {
        // Implementar llamada AJAX
        console.log('Activando todas las entidades...');
    }
}

function desactivarInactivas() {
    if (confirm('¿Está seguro de que desea eliminar permanentemente las entidades inactivas?')) {
        // Implementar llamada AJAX
        console.log('Eliminando entidades inactivas...');
    }
}

function generarReporte() {
    console.log('Generando reporte de entidades...');
    // Implementar generación de reporte
}

function importarEntidades() {
    const form = document.getElementById('formImportar');
    const formData = new FormData(form);
    
    // Implementar importación via AJAX
    console.log('Importando entidades...');
}
</script>
{% endblock %}